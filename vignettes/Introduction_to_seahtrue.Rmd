---
title: "Introduction_to_seahtrue"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction_to_seahtrue}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(seahtrue)
```


``` {r load_seahtrue_package}
library(seahtrue)
```


## Usage
Version 0.1.0 of the Seahtrue package contains a run_seahtrue function, which is
located at the master.R in the /R directory. This function performs all the required
steps for the current version of this package.

### Step 1 and 2: Loading and validating input.

This function loads a Seahorse Excel 
file as an input, which requires the full path to the Excel file. The Excel input 
will be validated. This to make sure it contains Seahorse data required for our 
analysis.

### Step 3 and 4: Preprocessing and validating preprocessed data.

The next step of our analysis is to preprocess the Seahorse Excel data that is 
loaded and validated during the previous step. This preprocess step produces a dataset 
with preprocessed data. 

The preprocessed dataset is then validated to check if the seahorse data meets
our criteria. When Seahorse data contains unexpected data, which doesn't meet our 
validation criteria, a warning will be given. 

Note that the Seahtrue analysis will still be performed with validation that 
doesn't meet our criteria.
In summary preprocessing is a mandatory step to make sure our Seahtrue calculation 
will work well.

## Seahtrue workflow
The main workflow of seahtrue will run when using the function run_seahtrue.
This function currently fulfills 4 different purposes:

1. Validates the input data                                   
2. Reads the input data                                  
3. Preprocesses the input data
4. Validates the preprocess output

## Preprocess output
The eventual output is a preprocessed dataset.

| Preprocessing steps                                          | 
|--------------------------------------------------------------|
| changing columns names                                       |
| adding new time columns                                      |
| adding injection info columns                                |
| add plate_id column                                          |
| calculating background data                                  |
| calculating raw pH emission data                             |

The following output is returned by step 3. 
   
|      Objects       |                                         Description                                            |
|--------------------|------------------------------------------------------------------------------------------------|
| plate_id           | Barcode from the 'Assay Configuration' sheet from the Seahorse Excel file.                     |
| filepath_seahorse  | Path to Seahorse Excel file.                                                                   |
| date               | Date derived from 'Assay Configuration' sheet of the Seahorse Excel file.                      |
| assay_info         | Dataframe with information from the 'Assay Configuration' sheet from the Seahorse Excel file.  |
| raw_info           | Dataframe with information from the 'Raw' sheet from the Seahorse Excel file.                  |
| injection_info     | Info from Operation log sheet.                                                                 |
| rate_data          | With information from the 'Rate' sheet from the Seahorse Excel file.                           |

## Examples

Here are some examples of the preprocessed output data of version 0.1.0 of our 
Seahtrue package. We use PBMC seahorse Excel data as an input. These Excel data were 
converted using the Seahorse .asyr output generated by the Agilent Wave Software.

To make sure our run_seahtrue function runs properly we can use the following 
PBMC datasets:

| * 20191219_SciRep_PBMCs_donor_A.xlsx                                    
| * 20200110_SciRep_PBMCs_donor_B.xlsx                                    
| * 20200110_SciRep_PBMCs_donor_C.xlsx                                    

These seahorse datasets are located at the inst/extdata directory. 
When installing seahtrue these dataset will be located at the installation 
location of seahtrue, and to access this location we have to make use of 
system.file() provided by 'base' R.

### Example 1: Run PBMC dataset donor A
